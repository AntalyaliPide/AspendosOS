name: Aspendos OS Final - Independent Edition
on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Kodlari Cek
        uses: actions/checkout@v4

      - name: Gerekli Araclar
        run: |
          sudo apt-get update
          sudo apt-get install -y xorriso grub-pc-bin grub-common mtools squashfs-tools debootstrap

      - name: Aspendos Final Insa Et
        run: |
          mkdir -p iso/boot/grub
          mkdir -p iso/live
          
          # 1. Temel Sistem ve Görsel Paketler
          sudo debootstrap --arch=amd64 bookworm chroot-dir http://deb.debian.org/debian/
          
          # 2. Paket Kurulumu (Calamares ve Temalar)
          sudo chroot chroot-dir /bin/bash -c "export DEBIAN_FRONTEND=noninteractive && \
            apt-get update && \
            apt-get install -y \
            linux-image-amd64 live-boot sudo \
            gnome-core gnome-shell-extension-prefs \
            calamares-settings-debian calamares \
            papirus-icon-theme arc-theme \
            firefox-esr gnome-terminal neofetch locales"

          # 3. KULLANICI VE TAM YETKİ (Sudo Fix)
          # Seni tüm yetkili gruplara ekliyoruz, "admin değilim" hatası tarihe karışıyor
          sudo chroot chroot-dir /bin/bash -c "useradd -m -g users -G sudo,adm,cdrom,dip,plugdev,lpadmin -s /bin/bash aspendos"
          echo "aspendos:123" | sudo chroot chroot-dir chpasswd
          echo "aspendos ALL=(ALL) NOPASSWD:ALL" | sudo tee chroot-dir/etc/sudoers.d/aspendos

          # 4. KİMLİK DEĞİŞİMİ
          sudo bash -c "echo 'aspendos-os' > chroot-dir/etc/hostname"
          sudo bash -c 'cat <<EOF > chroot-dir/etc/os-release
          PRETTY_NAME="Aspendos OS Elite"
          NAME="Aspendos OS"
          ID=aspendos
          ID_LIKE=debian
          EOF'

          # 5. LOGO VE DOKU OPERASYONU (Kesinlikle logo.jpg!)
          if [ -f "logo.jpg" ]; then
            sudo mkdir -p chroot-dir/usr/share/backgrounds/aspendos
            sudo cp logo.jpg chroot-dir/usr/share/backgrounds/aspendos/wallpaper.jpg
            
            # Debian görsellerini Aspendos ile ezme
            sudo mkdir -p chroot-dir/usr/share/images/desktop-base
            sudo cp logo.jpg chroot-dir/usr/share/images/desktop-base/default-desktop.jpg
            sudo cp logo.jpg chroot-dir/usr/share/images/desktop-base/login-background.jpg

            # Temayı (Arc-Dark) ve İkonları (Papirus) Zorla Aktifleştir
            sudo mkdir -p chroot-dir/etc/dconf/db/local.d/
            sudo bash -c 'cat <<EOF > chroot-
